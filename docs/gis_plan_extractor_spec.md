## אפיון מערכת: GIS Plan Extractor

### 1. מטרת האפליקציה

מערכת שולחנית לחילוץ וניתוח נתוני תוכניות בניה בתחום גיאוגרפי מוגדר מראש על ידי המשתמש, תוך שימוש ב־API של אתר מינהל התכנון ובנתונים הנמצאים באתר מבא"ת.

---

### 2. קהל יעד

* מתכננים עירוניים
* אנליסטים בתחום הנדל"ן
* יועצים ומודדים גיאוגרפיים
* רשויות וגופים ממשלתיים

---

### 3. מבנה המערכת

#### 🖥️ Frontend

* Electron
* React או Vanilla JS
* מפה אינטראקטיבית (Leaflet)
* טבלת נתונים

#### ⚙️ Backend

* FastAPI (פועל ב־localhost)
* קוד מונחה עצמים (OOP)
* שירותים: טעינה, חישוב, שאילתה, גירוד, עיבוד, ייצוא

#### 🔌 אינטגרציה

* Electron שולח בקשות ל־FastAPI דרך HTTP

---

### 4. תהליך העבודה

1. **טעינת קובץ ZIP:**

   * מכיל קובץ SHP או GeoJSON
   * פתיחה, קריאה והפקת פוליגון

2. **שליפת תוכניות מה־API של iplan:**

   * חישוב BBOX
   * בקשת GET מ־AGS: תוכניות תב"ע בתחום ה־BBox
   * סינון נוסף של התוכניות כך שייכללו **רק תוכניות שחיתוך הגיאומטריה שלהן עם הפוליגון המקורי אינו ריק** (ולא רק לפי המעטפת!)
   * המרה ל־FeatureCollection

3. **העשרת התוכניות מנתוני מבא"ת:**

   * גישה ל־pl\_url
   * שליפה עם Pyppeteer
   * צירוף הנתונים לשדות של כל תוכנית

4. **הצגה בממשק:**

   * מפה: פוליגון קלט + תוכניות כהות
   * טבלה: כל תוכנית עם שדות (pl\_number, pl\_name, quantity, וכו')

5. **ייצוא:**

   * GeoJSON / Excel / CSV / SHP לפי בחירת המשתמש

---

### 5. מבנה קוד מוצע (בקצה השרת)

* `main.py` - FastAPI ראשי
* `services/`

  * `polygon_loader.py`
  * `iplan_fetcher.py`
  * `mavat_scraper.py`
  * `plan_manager.py`
  * `export_service.py`
* `models/` - הגדרות מבני נתונים
* `utils/` - פונקציות עזר

---

### 6. עקרונות עיצוב

* פשטות ונגישות למשתמשים לא טכניים
* הרצה מקומית בלבד – ללא תלות בענן
* אבטחת מידע – קבצים לא נשלחים החוצה
* קוד מודולרי, מתועד וניתן להרחבה

---

### 7. עקרונות עבודה על הפרויקט

#### עבודה עם Git

* `main` – ענף יציב בלבד
* `develop` – ענף פיתוח מתגלגל
* `feature/*` – כל פיצ'ר או שינוי יתבצע בענף ייעודי
* כל שינוי יתבצע בענף (branch) נפרד
* Pull Requests יתועדו עם תיאור מלא (בעברית)
* הודעות commit יהיו באנגלית ותמציתיות

#### שיטת פיתוח הדרגתית

* פיצ'ר אחד בכל פעם – אפיון → בנייה → עיצוב → תיעוד → בדיקות
* עבודה בשיטת MVP – קודם בסיס יציב, אחר כך שיפורים

#### תהליך עבודה

* פתיחת ענף חדש לפי צורך
* חלוקה לחלקים קטנים עם משימות מדויקות
* כתיבת הקוד על ידי המפתח בלבד – ללא העתקה
* הדרכה שלב אחר שלב
* בסיום כל משימה – ביצוע commit ברור
* בסיום הפיצ'ר – Pull Request עם סיכום בעברית
* מיזוג לענף develop לאחר אישור

#### מבנה עבודה כללי

* `docs/` – תיעוד מפורט לכל פיצ'ר (markdown)
* `backend/` – קוד שרת FastAPI
* `frontend/` – קוד לקוח Electron (React)

#### עקרונות פיתוח

* שקיפות בתיעוד: כל שלב יתועד במסמך ושיחה
* החלטות ארכיטקטוניות יתועדו בקובץ `architecture.md`
* פיתוח מונחה משתמש: חוויית משתמש, פרטיות, RTL
* שימוש בטכנולוגיות עדכניות: FastAPI, Beanie, Next.js, Tailwind, TypeScript
* ממשקי API יתועדו עם OpenAPI/Swagger
* ניהול ידע לאורך זמן – סיכומים, תיעוד, הפניות בין שיחות וקבצים

---

### 8. שלבים להמשך פיתוח

1. הקמת שלד פרויקט + סביבת פיתוח
2. מימוש טעינת קובץ ZIP + קריאת הפוליגון
3. שליחת בקשה ל־AGS וחישוב BBOX
4. סינון לפי חיתוך גיאומטרי אמיתי עם הפוליגון
5. גירוד ממבא"ת (ב־Pyppeteer)
6. שילוב נתונים והצגה במפה/טבלה
7. ממשק ייצוא גמיש לפי סוג קובץ
